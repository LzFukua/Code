
### 这个用户画像是用什么应用方式对接数据产品,拿这个数据产品做什么事?  
我在的时候原先用的是Hbase,业务系统的模块拿到hbase的数据,用来做短信分发 个性化推荐 等等
1. 做这个就是去为营销推送系统去服务的 
2. 我们有个传统营销平台 之前数据库用的是青梅Greenplum,公司里面原来是有用到postgreSql,做人群划分的时候,底层的查询技术用的Roaringbitmap
后面改成了用的dorisDB

标签量有多少  1500多 √
标签模型存在哪 哪个层 结果放在哪个层 训练数据再哪个层
hive  dws
做个性化推荐 做用户流失的挽留 短信分发 等等

### 标签命名方式 
标签主题+用户维度+标签类型+标签归类

### 标签怎么维护的
我们是有一张专门的表去存储这种标签，然后我们标签有些是日更有些是周更或者月更的。


### rowkey设计
就是以guid

### 为什么用ES不用Hbase
因为我们这个用户画像以查询为主嘛,用ES可以根据标签查询,而Hbase只能以行键查询,就没那么容易去以规则去圈人群.
而且我们这个项目做的是离线的画像，如果要做实时的话就可以考虑用hbase，但是这个集群的配置可能会要高一些

### 标签是怎么加工的
hive批量导入ES


### 更新频率 
统计类标签基本上都是日更
规则类的标签 可以选择日更 也可以周更 也可以月更
挖掘类算法类的 一般都是周更 月更  

### 更新逻辑
1. 增量数据追加更新  例如用户姓名手机号性别年龄地域更新 
更新的逻辑：日活表导入后fulljoin 取最新的值 

2. 历史累计型数据更新 例如历史以来订单总额 历史以来订单总数
更新的逻辑：日聚合full join 要么累加要么替换 

3. 滑动窗口更新累加或全量替换  例如 最近3日访问 最近7日xxx
更新的逻辑 ：先做天粒度的聚合表  然后按需要的天汇总 sum max  然后结果数据替换昨天的

4. 滑动窗口部分替换更新 例如 最近1月购买件数最多的品类 
更新的逻辑：先做每日聚合,统计用户每天的各品类的件数 然后聚合之前的求购买最多的品类

5. 滚动窗口更新 针对自然周 自然月等时间约束
更新的逻辑：按自然周自然月为粒度进行聚合统计

6. 兴趣类：衰减
流失风险预测 用sparkmllib包 放模型去调用一下

### 用户画像存储模型设计 
按计算单元且更新频率来划分计算过程中的中间结果表
每个计算单元所生成的部分标签-->大部分采用横表,  就是收藏量点赞量这种


### 你们会不会有热点问题
1. guid做rowkey
2. 读热点 --> 虽然guid作为rowkey在hbase的region中按区间连续分布 但是上层应用的查询本身事随机的,所以并不存在读热点问题
3. 写热点 --> 我们使用bulkload的方式(bulkload 先在hbase外用分布式运算引擎spark将导入的数据转成Hfile格式 然后将转好的格式文件直接导入到hbase对应的region,在hdfs上对应存储;并在这个过程中通知Hbase的master更新相关元信息) 

---


### 把数据变成Hfile的bulkload实现方法
在hive中 先用sql把各种横表转成纵表 union到一起 ![](images/2022-08-14-14-45-05.png)
1. 先把数据加工成RDD[(ImmutableBytesWritable,KeyValue)]元组形式, key为rowkey的封装,value就是Hbase的kv封装
2. 调用底层的 saveAsNewAPIHadoopFile
3. 构造一个导入Hfile的工具类   
写好HfileOutPutFormat的参数配置
构造Hbase的客户端
BulkloadHfiles.create(job.getConfiguration) file.bulkload(xx,new path(xxxx))

---

### 下一天再bulkload会不会出问题  
不会(hbase查到的值都是新的值)


### 导入数据量有点大 会不会有什么影响  
不会有影响 因为直接导入到HDFS上,只是去通知一下master改一下元数据 所以没什么影响  



### 一天导多少个数据 
65-75G左右 
因为有些是周更月更的 所以会有一点幅度
所有怎么都不会对Hbase有压力

---

### 数据的切换对接问题 上面的flink没停过 但下面开始ES会不会有问题
不会,因为导进去只有一瞬间,而且上层查也是一瞬间,在没导进去之前都是老数据而已

如果是别的数据库切换,那就多做一张表,然后做一个标记,如果写好了新表就更新标记,然后上层系统切换 

上层查询用的dorisDB/starRock 但我只负责导入到ES 剩下的不太清楚了


### HBase在进行模型设计时重点在什么地方？一张表中定义多少个Column Family最合适？为什么？
列族的个数具体看表的数据,一般来说划分标准是看一些数据的访问频度,比如说一张表里面有些列访问相对频繁,而另一些列访问很少,这时候可以把这张表划分成两个列族,分开存储,就可以提高访问效率

### 画像
房东画像  服务质量
客源画像  评价质量


### 用户画像中的标签个数 分为哪几类 
1500多个 角色会分为三大类 通俗的话就是就是民宿目标清晰的 需要我们指引的 和 没什么想法的
然后标签的话会分为基本属性统计类，行为规则类，算法类的
1. 统计类：基于用户注册或业务活动中直接获取的基本信息变为标签，没有进行人为的逻辑判断，只是客观反映
一个现实。如：年龄、性别等；
2. 规则类：基于用户在业务端业务中的活动或是确定的规则中产生信息数据符合该条件的客户会自动的打上该标
签，对用户进行规则权重打分， 智能标签会按照一定周期进行更新计算，例：消费能力标签，节假日旅游次数标签；
3. 算法类：基于算法机器学习所判断用户的深层属性、偏好以及潜在需求，例：民宿风格偏好标签、 色彩偏好标
签、 地理位置常驻标签、时间段模型标签、 RFM 模型标签等；


### 标签占比
统计类标签  大部分是85% 
规则标签 10%
挖掘标签 5%

---  

基本信息类标签 : 
统计类标签
1. 好评统计 差评统计 点赞统计 评论统计 收藏统计 访问统计
2. 消费订单 订单数 订单额 
3. 退单次数 比如领取优惠券次数

用户有
自然性别
购物性别
会员等级
地域 星座 年龄 

---

交互行为类标签 : 规则类标签  规则标签的做法 
基于统计标签  进行规则权重打分 然后按分值的区间判断 输出枚举值
1. 用户粘性级别 (高中低)
2. **用户活跃级别 RFE** 
   1. R 最近一次访问时间
   2. F 访问频率
   3. E 页面互动度
3. 用户生命周期  单值型标签 只会有一种情况  比如该用户是成长期 成熟期 衰退期  沉睡期  
 规则不记得了 依稀记得是和注册时间还有最近的月消费有关 公式是产品经理定的

 **用户价值等级RFM**
  R最近一次消费
  F消费频率 
  M消费金额
4. 用户消费类型  大学生型 精打细算型 
5. 订单优惠使用率   

--- 
算法预测类标签: 挖掘标签
1. 用户流失风险
2. 购买能力模型
3. 促销敏感度
4. 用户职业属性
5. 用户性格
6. 兴趣爱好

404  403  401
